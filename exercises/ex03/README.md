[Home - RAP120](../../README.md)

# Exercise 3: Analyze the ABAP helper class and create ABAP unit tests

## Introduction 

In the previous exercise, you've enhanced the CDS data definition ![datadefinition](images/adt_ddls.png)**`ZR_TRAVEL_###`** with a simply logic and generated its unit tests using **ABAP Unit Test Generation Capability**ðŸ’Ž (_see [Exercise 2](../ex02/README.md)_).

In this exercise, you will now analyze the ABAP helper class ![class](images/adt_class.png)**`ZCL_TRAVEL_HELPER_###`** created in [Exercise 1.7](../ex01/README.md/#exercise-16-publish-and-preview-the-travel-app) and create ABAP unit tests for it using **ABAP Unit Test Generation Capability**ðŸ’Ž.
 
### Exercises
- [3.1 - Define the ABAP unit test class](#exercise-31-define-the-abap-unit-test-class)
- [3.2 - Analyze dependencies and generate test doubles](#exercise-32-analyze-dependencies-and-generate-test-doubles)
- [3.3 - Add unit test with Joule Code Prediction Capabilitiy](#exercise-33-add-unit-test-with-joule-code-prediction-capability)
- [Summary & Next Exercise](#summary--next-exercise)


## Exercise 3.1: Define the ABAP unit test class
[^Top of page](#Introduction)

> Define the unit test class ![class](images/adt_class.png)**`LTCL_TRAVEL_HELPER_###`**.

<details>
  <summary>ðŸ”µClick to expand!</summary>

   1. Go to the **Test Clasess** tab at the bottom of class editor and insert a template for ABAP Unit test classes.
 
      To do that, just type **`testClass`** in your editor, then press **Ctrl + Space** to open the code completion list. 
 
      Select **`testClass - Test class (ABAP Unit)`** from the suggested template entries.

   2. Now change the default local test class name to **`LTCL_TRAVEL_HELPER_###`**.
 
   3. Delete the default method **`first_test`** from the definition and implementation sections. 
 
   4. Save![save icon](images/adt_save.png) and activate![activate icon](images/adt_activate.png) the changes.

   ![](/exercises/ex03/images/rap120_ex31.gif)


</details>

## Exercise 3.2: Analyze dependencies and generate test doublesðŸ’Ž
[^Top of page](#Introduction)

>  Analyze the ABAP helper class ![class](images/adt_class.png)**`ZCL_TRAVEL_HELPER_###`**. 
>  
> Understanding class dependencies is essential for identifying unstable dependencies, such as those involving databases or other APIs. These test-unfriendly dependencies may return unexpected test results depending on systems, users, or other aspects in your code. Therefore, it's useful to replace test-unfriendly dependencies with test doubles to enhance the stability of your tests.
> 
> â„¹ï¸ **Info**: To access the Joule copilot, click on the magnifier icon in the toolbar and type **_Joule_**.  
>
>    ![](/exercises/ex03/images/adt_open_joule.png)

<details>
  <summary>ðŸ”µClick to expand!</summary>
  <br>

   1. From the _Project Explorer_, right-click on the class ![class](images/adt_class.png) **`ZCL_TRAVEL_HELPER_###`** and select **Joule > Start Chat for ABAP Unit**
 
   2. From the Joule copilot, click on  **Find Test-Unfriendly Dependencies** to start the analysis. As you can see, ![class](images/adt_class.png)**`ZCL_TRAVEL_HELPER_###`** has one dependency with the database table ![table](images/adt_tabl.png)**`/DMO/CUSTOMER`**. 

   3. Now, from Joule copilot, select the option **Generate Test Double for Database Table /dmo/customer**

   4. Then, click on **Generate in ltc_travel_helper_###**
   
   5. Review the generated code in Joule copilot and press **Copy**. 
 
   6. Switch to the **Test Classes** tab and replace the current source code with the one copied from the Joule view.

  ![](/exercises/ex03/images/rap120_ex32.gif)

</details>

## Exercise 3.3: Add unit test with Joule Code Prediction CapabilityðŸ’Ž
[^Top of page](#Introduction)

> Now utilize **Joule Code Prediction Capability**ðŸ’Ž to assist you in developing unit test logic.
>  
> âš  **Warning regarding Joule's outputs** âš    
> Please be aware that the outputs generated by Joule in this exercise description may differ from yours, and the provided code snippets should be adjusted accordingly. **Always review the code generated by Joule**.

<details>
  <summary>ðŸ”µ Click to expand!</summary>
  <br>

  1. Add the method interface **`validate_customer_success`** in the definition section:

     ```ABAP
      validate_customer_success FOR TESTING. 
     ```

  2. Add **`validate_customer_success`** implementation using ADT Quick Fix. 
 
  3. Press **Enter**. Joule will suggest the unit test code. 
 
     > â„¹ï¸ **Hint**: You can toggle the **Joule Code Prediction Capability** in the toolbar ![](/exercises/images/adt_joule_code_completion2.png)
 
  4. Review the code and press _**Tab**_
 
  5. Save![save icon](images/adt_save.png) and activate![activate icon](images/adt_activate.png) the changes.
 
  6. Run the unit tests.

     The test class ![abapclass](images/adt_class.png)**`LTCL_TRAVEL_HELPER_###`** should look like this:

     ```ABAP
     CLASS ltcl_travel_helper_### DEFINITION FINAL FOR TESTING
       DURATION SHORT RISK LEVEL HARMLESS.

       PRIVATE SECTION.
         "! ABAP SQL test environment
         CLASS-DATA environment TYPE REF TO if_osql_test_environment.
         CLASS-METHODS:
           "setup test double framework
           class_setup,
           "stop test doubles
           class_teardown.

         METHODS:
           "rollback test doubles
           setup,

           "! Test helper method
           configure_db_testdoubles,

           validate_customer_success for testing.

     ENDCLASS.

     CLASS ltcl_travel_helper_### IMPLEMENTATION.

       METHOD class_setup.
         "setup test double framework
         environment = cl_osql_test_environment=>create(
           i_dependency_list = VALUE #( ( '/DMO/CUSTOMER' ) ) ).
       ENDMETHOD.

       METHOD class_teardown.
         "stop the test doubles
         environment->destroy( ).
       ENDMETHOD.

       METHOD setup.
         "clear the content of the test doubles per test
         environment->clear_doubles( ).
         configure_db_testdoubles( ).
       ENDMETHOD.

       METHOD configure_db_testdoubles.
         DATA customer_stub_data TYPE STANDARD TABLE OF /dmo/customer.

         customer_stub_data = VALUE #(
           ( client = '100' customer_id = '000001' )
           ( client = '100' customer_id = '000002' )
           ( client = '100' customer_id = '000003' )
         ).
         environment->insert_test_data( customer_stub_data ).
       ENDMETHOD.

       METHOD validate_customer_success.
         DATA(cut) = NEW zcl_travel_helper_###( ).
         DATA(result) = cut->validate_customer( '000001' ).

         cl_abap_unit_assert=>assert_equals( exp = abap_true act = result ).
       ENDMETHOD.

     ENDCLASS.
     ```

  7. You can try to implement the unit test **`validate_customer_failure`** following the same steps.

     ![](/exercises/ex03/images/rap120_ex33.gif)

</details>


## Summary & Next Exercise
[^Top of page](#Introduction)

Now that you've... 
- analyzed test-unfriendly dependencies and generated test doubles with **ABAP Unit Test Generation Capability**,
- added a new unit test with **Joule Code Prediction Capability**,

you can continue with the next exercise â€“ **[Exercise 4: Add a validation](../ex04/README.md)**

---

