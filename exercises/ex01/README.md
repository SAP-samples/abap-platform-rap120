[Home - RAP120](../../README.md)

# Exercise 1: Generate a SAP Fiori using the ABAP Cloud Generator: transactional app from scratch 

## Introduction

In this exercise, you will create a transactional UI service along with the underlying RAP business object to process _Travel_ entities. 

First, you'll create an ABAP package, a database table, and an ABAP class to populate the database table with demo data. Using **ABAP Cloud Generators: Transactional App from Scratch💎**, you will input a natural language prompt describing the application, and all its artifacts will be generated. This includes the CDS data model, behavior definition, behavior implementation class, service definition, and service binding. After that, you'll publish and check your Travel application using the SAP Fiori elements preview.

> Refer to the [ABAP Cloud Roadmap Information - GenAI](https://help.sap.com/docs/abap-cross-product/roadmap-info/genai?locale=en-US) for more details.

### Exercises
- [1.1 - Create package](#exercise-11-create-package)
- [1.2 - Generate the transactional UI service](#exercise-12-generate-the-transactional-ui-service)
- [1.3 - Adjust metadata extension](#exercise-13-Adjust-metadata-extension)
- [1.4 - Adjust behavior definition](#exercise-14-Adjust-behavior-definition)
- [1.5 - Publish and preview the _Travel_ app](#exercise-15-publish-and-preview-the-travel-app)
- [1.6 - Create an helper class](#exercise-16-create-an-helper-class)
- [Summary & Next exercise](#summary--next-exercise)
 
 
> ℹ️ **Reminder:**    
> - Don't forget to replace all occurences of the placeholder **`###`** with your group ID in the exercise steps below.  
> - You can use the ADT function **Replace All** (**Ctrl+F**) for the purpose.   
> - If you don't have a group ID yet, then check the section [Getting Started - Group ID](../ex0/README.md#group-id) to define a suffix for your artifacts.    

## Exercise 1.1: Create package
[^Top of page](#Introduction)

> Create your exercise package ![package](images/adt_package.png)**`ZRAP120_AI_###`**.
>    
> This ABAP package will contain all the artifacts you will be creating in the different exercises of this hands-on session.

 <details>
  <summary> 🔵 Click to expand!</summary>

   1. In ADT, go to the **Project Explorer**, right-click on the package **`ZLOCAL`**, and select **New** > **ABAP Package** from the context menu. 

      <img src="images/p1a.png" alt="table" width="50%">
   
   2. Maintain the required information and then, click on **Next >**.
      > Note: **`###`** is your assigned group ID or you can choose your own suffix. Please choose a suitable combination of three (3) numbers and characters, e.g. **`476`** or **`ZT1`**
 
       - Name: **`ZRAP120_AI_###`**
       - Description: _**`RAP AI Package ###`**_
       - Select the box `☑️` **Add to favorites package**
       - Superpackage: **`ZLOCAL`**
       
   3. Check that the Package Type is _Development_ and Software Component _ZLOCAL_. Click on **Next >**
   4. In the Transport Request step, maintain the _Request Description_ (e.g. _**RAP120 Package ###**_), and click on **Finish**.
      
      <!-- <img src="images/p1c.png" alt="table" width="50%"> -->

</details>


## Exercise 1.2: Generate the transactional UI service💎
[^Top of page](#Introduction)
> Generate an OData UI service using the ABAP Cloud Generator: Transactional app from scratch 💎

 <details>
  <summary> 🔵 Click to expand!</summary>

   1. Right-click on your ABAP package ![package](images/adt_package.png)**`ZRAP120_AI_###`** and select **Generate ABAP Repository Objects** from the context menu.
      
      Select the entry **OData UI Service from Scratch** in the wizard and click **Next >**.
      
      Maintain your package name **`ZRAP120_AI_###`** and click **Next >**.                  

   2. Please copy and paste the prompt provided below in the chat, and press **Enter**. Ensure to replace `###` with your chosen suffix.
      
      ```PROMPT
      Create a transaction application for travel management. Create the entity Travel based on the structure /DMO/TRAVEL_DATA. 
      The second entity is Booking based on /DMO/BOOKING_DATA. The generated objects should end with  suffix “###”
      ```
 
   3. Joule will recommend the Business Object entities _Travel_ and _Booking_ along with their respective fields. Press **Accept**.
 
      > ℹ️ NOTE: The names of the artifacts, database fields, and other elements in your project may differ from those shown in this tutorial, as they are generated by GenAI
       
   4. You can add new fields to the entities either by using the wizard or the chat. We will use this feature and add two fields called **`Destination`**, **`DiscountedFlightPrice`** and **`SightseeingsTips`**.   
      To do so, copy and paste the prompt provided below, and press **Enter**
      
      ```PROMPT
         Add  Destination field for entity Travel, use /DMO/CITY as data element. 
         Add  SightseeingsTips field for entity Travel, use /DMO/DESCRIPTION as data element. 
         Add DiscountedFlightPrice field for entity Booking, use /DMO/FLIGHT_PRICE as data element. 
      ```

   5. Joule will suggest adding the fields **`Destination`**, **`DiscountedFlightPrice`** and **`SightseeingsTips`**. Press **Accept**. 
   
      > Please, make sure that the **`CurrencyCode`** is only set for the **`DiscountedFlightPrice`**
      >
      > ![](/exercises/ex01/images/rap120_2505_ex125.png)

   6. ⚠️⚠️⚠️ Before continuing and generating the RAP business object please make sure that you have added the fields  **`Destination`**, **`DiscountedFlightPrice`** and **`SightseeingsTips`** to your data model.
      If you have not added the fields, please go back to **Step 4** before continuing with the generation of the RAP BO.

   7. Click on **Next >**. A preview of the generated objects will appear. Click on **Next >** again, select the transport request, and then click on **Finish**.
  
   8. Go to the _**Project Explorer**_ view and check all object that have been generated in your package. Press **F5** to refresh your package if needed.

   ![](/exercises/ex01/images/rap120_ex12.gif)
  
</details>

## Exercise 1.3: Adjust metadata extension
[^Top of page](#Introduction)
> Adjust the UI for _Travel_ and _Booking_ entities
<details>
  <summary> 🔵 Click to expand!</summary>

  1. Open the metadata extension ![package](images/adt_ddlx.png) **`ZC_TRAVEL###`** and make the adjustments as shown in the code snippet below. ![package](images/adt_ddlx.png) **`ZC_TRAVEL###`** should look like this: 
   > ℹ️ NOTE: The names of the artifacts, database fields, and other elements in your project may differ from those shown in this tutorial, as they are generated by GenAI

  ```
   @Metadata.layer: #CORE
   @UI.headerInfo.title.type: #STANDARD
   @UI.headerInfo.title.value: 'UUID'
   @UI.headerInfo.description.type: #STANDARD
   @UI.headerInfo.description.value: 'UUID'
   annotate view ZC_TRAVEL### with
   {

   @UI.hidden: true
   @EndUserText.label: 'UUID'
   @UI.facet: [ {
      label: 'General Information', 
      id: 'GeneralInfo', 
      purpose: #STANDARD, 
      position: 10 , 
      type: #IDENTIFICATION_REFERENCE
   }, 
   {
      label: 'Sightseeing Tips', 
      id: 'SightseeingTips', 
      targetQualifier: 'SightseeingTips',
      purpose: #STANDARD, 
      position: 11 , 
      type: #IDENTIFICATION_REFERENCE
   }, 
   {
      label: 'Booking Items', 
      id: 'BookingItems', 
      purpose: #STANDARD, 
      position: 12 , 
      type: #LINEITEM_REFERENCE, 
      targetElement: '_Booking'
   } ]
   @UI.identification: [ {
      position: 10 , 
      label: 'UUID'
   } ]
   @UI.lineItem: [ {
      position: 10 , 
      label: 'UUID'
   } ]
   @UI.selectionField: [ {
      position: 10 
   } ]
   UUID;
   
   @UI.identification: [ {
      position: 20 
   } ]
   @UI.lineItem: [ {
      position: 20 
   } ]
   @UI.selectionField: [ {
      position: 20 
   } ]
   AgencyID;
   
   @UI.identification: [ {
      position: 30 
   } ]
   @UI.lineItem: [ {
      position: 30 
   } ]
   @UI.selectionField: [ {
      position: 30 
   } ]
   CustomerID;
   
   @UI.identification: [ {
      position: 40 
   } ]
   @UI.lineItem: [ {
      position: 40 
   } ]
   @UI.selectionField: [ {
      position: 40 
   } ]
   BeginDate;
   
   @UI.identification: [ {
      position: 50 
   } ]
   @UI.lineItem: [ {
      position: 50 
   } ]
   @UI.selectionField: [ {
      position: 50 
   } ]
   EndDate;
   
   @UI.identification: [ {
      position: 60 
   } ]
   @UI.lineItem: [ {
      position: 60 
   } ]
   BookingFee;
   
   @UI.identification: [ {
      position: 70 
   } ]
   @UI.lineItem: [ {
      position: 70 
   } ]
   TotalPrice;
   
   @UI.identification: [ {
      position: 100 
   } ]
   @UI.lineItem: [ {
      position: 100 
   } ]
   @UI.selectionField: [ {
      position: 100 
   } ]
   Status;
   
   @UI.identification: [ {
      position: 110 
   } ]
   @UI.lineItem: [ {
      position: 110 
   } ]
   @UI.selectionField: [ {
      position: 110 
   } ]
   Destination;

   @UI.multiLineText: true
   @UI.identification: [ {
      position: 120,
      qualifier: 'SightseeingTips',
      label: 'Sightseeing Tips'
   } ]
   SightseeingsTips;

   
   @EndUserText.label: '_BaseEntity'
   @UI.identification: [ {
      position: 190 , 
      label: '_BaseEntity'
   } ]
   @UI.lineItem: [ {
      position: 190 , 
      label: '_BaseEntity'
   } ]
   @UI.selectionField: [ {
      position: 190 
   } ]
   _BaseEntity;
   }
  ```
  1. Open the metadata extension ![package](images/adt_ddlx.png) **`ZC_BOOKING###`** and make the adjustments as shown in the code snippet below. ![package](images/adt_ddlx.png) **`ZC_BOOKING###`** should look like this: 
   > ℹ️ NOTE: The names of the artifacts, database fields, and other elements in your project may differ from those shown in this tutorial, as they are generated by GenAI

  ```
   @Metadata.layer: #CORE
   @UI.headerInfo.title.type: #STANDARD
   @UI.headerInfo.title.value: 'UUID'
   @UI.headerInfo.description.type: #STANDARD
   @UI.headerInfo.description.value: 'UUID'
   annotate view ZC_BOOKING### with
   {
   @UI.hidden: true
   @EndUserText.label: 'UUID'
   @UI.facet: [ {
      label: 'General Information', 
      id: 'GeneralInfo', 
      purpose: #STANDARD, 
      position: 10 , 
      type: #IDENTIFICATION_REFERENCE
   } ]
   @UI.identification: [ {
      position: 10 , 
      label: 'UUID'
   } ]
   @UI.lineItem: [ {
      position: 10 , 
      label: 'UUID'
   } ]
   @UI.selectionField: [ {
      position: 10 
   } ]
   UUID;
   
   @UI.hidden: true
   @EndUserText.label: 'ParentUUID'
   @UI.identification: [ {
      position: 20 , 
      label: 'ParentUUID'
   } ]
   @UI.lineItem: [ {
      position: 20 , 
      label: 'ParentUUID'
   } ]
   @UI.selectionField: [ {
      position: 20 
   } ]
   ParentUUID;
   
   @UI.identification: [ {
      position: 30 
   } ]
   @UI.lineItem: [ {
      position: 30 
   } ]
   @UI.selectionField: [ {
      position: 30 
   } ]
   BookingDate;
   
   @UI.identification: [ {
      position: 40 
   } ]
   @UI.lineItem: [ {
      position: 40 
   } ]
   @UI.selectionField: [ {
      position: 40 
   } ]
   CustomerID;
   
   @UI.identification: [ {
      position: 50 
   } ]
   @UI.lineItem: [ {
      position: 50 
   } ]
   @UI.selectionField: [ {
      position: 50 
   } ]
   CarrierID;
   
   @UI.identification: [ {
      position: 60 
   } ]
   @UI.lineItem: [ {
      position: 60 
   } ]
   @UI.selectionField: [ {
      position: 60 
   } ]
   ConnectionID;
   
   @UI.identification: [ {
      position: 70 
   } ]
   @UI.lineItem: [ {
      position: 70 
   } ]
   @UI.selectionField: [ {
      position: 70 
   } ]
   FlightDate;
   
   @UI.identification: [ {
      position: 80 
   } ]
   @UI.lineItem: [ {
      position: 80 
   } ]
   @UI.selectionField: [ {
      position: 80 
   } ]
   FlightPrice;
   
   @UI.identification: [ {
      position: 100,
      label: 'Discounted Flight Price' 
   } ]
   @UI.lineItem: [ {
      position: 100 ,
      label: 'Discounted Flight Price' 
   } ]
   @UI.selectionField: [ {
      position: 100 
   } ]
   DiscountedFlightPrice;
   
   @EndUserText.label: '_BaseEntity'
   @UI.identification: [ {
      position: 120 , 
      label: '_BaseEntity'
   } ]
   @UI.lineItem: [ {
      position: 120 , 
      label: '_BaseEntity'
   } ]
   @UI.selectionField: [ {
      position: 120 
   } ]
   _BaseEntity;
   }

  ```

  3. Save ![save icon](images/adt_save.png) (**Ctrl+S**) and activate ![activate icon](images/adt_activate.png) the changes.
     
</details>

## Exercise 1.4: Adjust behavior definition
[^Top of page](#Introduction)
> Adjust the behavior definition ![behaviordefinition](images/adt_bdef.png)**`ZR_TRAVEL###`**
<details>
  <summary> 🔵 Click to expand!</summary>

   1. Go to the **Project Explorer** and open the behavior definition ![behaviordefinition](images/adt_bdef.png)**`ZR_TRAVEL###`**.  
   
   2. In ![behaviordefinition](images/adt_bdef.png)**`ZR_TRAVEL###`**, add the fields **`SightseeingsTips`** and **`TotalPrice`** in *`field ( readonly )`* for **`ZR_TRAVEL###`**.
      
      ```ABAP
         field ( readonly )
         UUID,
         SightseeingsTips,
         TotalPrice,
         LocalCreatedBy,
         LocalCreatedAt,
         LocalLastChangedBy,
         LocalLastChangedAt,
         LastChangedAt;
      ```   
   3. In ![behaviordefinition](images/adt_bdef.png)**`ZR_TRAVEL###`**, add *`field ( mandatory : create )`* and below the fields **`Destination`**, **`StartDate`** and **`EndDate`** for **`ZR_TRAVEL###`**.

      ```ABAP
         field ( mandatory : create )
         Destination,
         BeginDate,
         EndDate;
      ```

   4. In ![behaviordefinition](images/adt_bdef.png)**`ZR_TRAVEL###`**, add the field **`DiscountedFlightPrice` in *`field ( readonly )`* for **`ZR_BOOKING###`**

      ```ABAP
         field ( readonly )
         UUID,
         ParentUUID,
         DiscountedFlightPrice;
      ```
   5. Your ![behaviordefinition](images/adt_bdef.png)**`ZR_TRAVEL###`** should look like this: 

      ```ABAP
         managed implementation in class ZBP_R_TRAVEL002 unique;
         strict ( 2 );
         with draft;
         extensible;
         define behavior for ZR_TRAVEL002 alias Travel
         persistent table ztravel002
         extensible
         draft table ztravel_d002
         etag master LocalLastChangedAt
         lock master total etag LastChangedAt
         authorization master ( global )
         {
         field ( readonly )
         UUID,

         // Added in step 2
         SightseeingsTips,
         TotalPrice,

         LocalCreatedBy,
         LocalCreatedAt,
         LocalLastChangedBy,
         LocalLastChangedAt,
         LastChangedAt;

         // Added in step 3
         field ( mandatory : create )
         BeginDate,
         EndDate,
         Destination;

         field ( mandatory )
         CustomerId;

         field ( numbering : managed )
         UUID;


         create;
         update;
         delete;

         validation validateCustomer on save { create; field CustomerID; }

         draft action Activate optimized;
         draft action Discard;
         draft action Edit;
         draft action Resume;
            draft determine action Prepare{
            validation validateCustomer;
         }

         mapping for ztravel002 corresponding extensible
            {
               UUID               = uuid;
               TravelID           = travel_id;
               AgencyID           = agency_id;
               CustomerID         = customer_id;
               BeginDate          = begin_date;
               EndDate            = end_date;
               BookingFee         = booking_fee;
               TotalPrice         = total_price;
               CurrencyCode       = currency_code;
               Description        = description;
               Status             = status;
               Destination        = destination;
               SightseeingsTips   = sightseeings_tips;
               LocalCreatedBy     = local_created_by;
               LocalCreatedAt     = local_created_at;
               LocalLastChangedBy = local_last_changed_by;
               LocalLastChangedAt = local_last_changed_at;
               LastChangedAt      = last_changed_at;
            }

         association _Booking { create; with draft; }

         }

         define behavior for ZR_BOOKING002 alias Booking
         persistent table zbooking002
         extensible
         draft table zbooking_d002
         etag dependent by _Travel
         lock dependent by _Travel
         authorization dependent by _Travel
         {
         field ( readonly )
         UUID,
         ParentUUID,
         // Added in step 4
         DiscountedFlightPrice;

         field ( numbering : managed )
         UUID;


         update;
         delete;

         mapping for zbooking002 corresponding extensible
            {
               UUID                  = uuid;
               ParentUUID            = parent_uuid;
               BookingID             = booking_id;
               BookingDate           = booking_date;
               CustomerID            = customer_id;
               CarrierID             = carrier_id;
               ConnectionID          = connection_id;
               FlightDate            = flight_date;
               FlightPrice           = flight_price;
               CurrencyCode          = currency_code;
               DiscountedFlightPrice = discounted_flight_price;
            }

         association _Travel { with draft; }

         }
      ```

</details>

## Exercise 1.5: Publish and preview the Travel app
[^Top of page](#Introduction)

> Publish the local service endpoint of your service binding ![service binding](images/adt_srvb.png)**`ZUI_TRAVEL_O4###`**  and start the _Fiori elements App Preview_ in ADT.  

 <details>
  <summary>🔵Click to expand!</summary>

   1. Go to your service binding ![service binding](../images/adt_srvb.png)**`ZUI_TRAVEL_O4###`** and click **Publish** to publish its local service endpoint to view service URL, entity sets, and associations. 
   
   2. Once it is published, select the entity **`Travel`** in the **Entity Set and Association** and then click on **Preview**.
     
   3. The preview of the _Travel_ app is now displayed in the browser without any data.  
       
</details>

## Exercise 1.6: Create an helper class
[^Top of page](#Introduction)

> Create the ABAP helper class ![class](images/adt_class.png)**`ZCL_TRAVEL_HELPER_###`** that will contain common business logic that can be consumed by different business objects and methods - for example, in determinations or validations within our RAP application. 
> 
> This approach will allow the centralization of unit tests avoiding the need to maintain them within each individual business object.

<details>
  <summary> 🔵 Click to expand!</summary>

  1. Right-click on your package ![package](images/adt_package.png)**`ZRAP120_AI_###`** and select **New > ABAP Class**
     -  Name: **`ZCL_TRAVEL_HELPER_###`**
     -  Description: **`Travel helper class ###`**

  2. Copy and paste the following code
     
     > ℹ️**Reminder**: Don't forget to replace the suffix placeholder **`###`** with your chosen or assigned group ID 

     ```ABAP
     CLASS zcl_travel_helper_### DEFINITION
      PUBLIC
      FINAL
      CREATE PUBLIC .

      PUBLIC SECTION.
        METHODS: validate_customer IMPORTING iv_customer_id TYPE /dmo/customer_id RETURNING VALUE(rv_exists) TYPE abap_bool.
        METHODS: get_booking_status IMPORTING iv_status TYPE /dmo/booking_status_text RETURNING VALUE(rv_status) TYPE /dmo/booking_status.
        METHODS: get_sightseeing_tips IMPORTING iv_city TYPE /dmo/city RETURNING VALUE(rv_sightseeing_tips) TYPE /dmo/description.


      PROTECTED SECTION.
      PRIVATE SECTION.
     ENDCLASS.


     CLASS zcl_travel_helper_### IMPLEMENTATION.

      METHOD validate_customer.
         SELECT SINGLE
            FROM /dmo/customer
            FIELDS @abap_true AS line_exists
            WHERE customer_id = @iv_customer_id
            INTO @rv_exists.
      ENDMETHOD.

      METHOD get_booking_status.
        CASE iv_status.
          WHEN 'Booked'.
            rv_status = 'B'.
          WHEN 'New'.
            rv_status = 'N'.
          WHEN 'Cancelled'.
            rv_status = 'X'.
        ENDCASE.
      ENDMETHOD.

      METHOD get_sightseeing_tips.
         " We will use the ABAP AI SDK powered by ISLM to call an LLM and generate sightseeing tips for a specific city.
      ENDMETHOD.

     ENDCLASS.
     ```
 
  3. Save ![save icon](images/adt_save.png) and activate ![activate icon](images/adt_activate.png) the changes.

</details>
  
## Summary & Next exercise
[^Top of page](#Introduction)

Now that you've... 
- created an ABAP package,
- generated a SAP Fiori app based on the ABAP RESTful Application Programming model (RAP) from scratch,
- published a local service point, and started the _Fiori elements App Preview_ in ADT, and
- created an helper class,

you can continue with the next exercise - **[Exercise 2: Enhance the CDS data model and create CDS unit tests](../ex02/README.md)**.

---
